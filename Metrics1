var sheets = SpreadsheetApp.getActiveSpreadsheet().getSheets()
var numOpenTickets = 0
var numClosedTickets = 0

//[same day, under 24, 24 to 48, 48+]
var responseTimes = [0,0,0,0]

//[satisfied, moderately satisfied, unsatisfied, unknown]
var satisfactionLevels = [0,0,0,0]

var issues_followingInstructions = 0
var issues_languageBarrier = 0

var impact_wouldHaveDisconnected = 0
var impact_wouldHaveContactedGrantee = 0
var impact_intereferedWithWork = 0

function update() {
  for(var i = 3; i < sheets.length; i++) {
    sheets[i].getRange('B1').setValue(sheets[i].getSheetName())
    //OPEN or CLOSED
    var status = new String(sheets[i].getRange('B12').getValue())
    console.log("Status: " + status);
    if (status=='Open') {
      numOpenTickets++
    } else {
      numClosedTickets++
    }
    //Response Time
    var responseTime = new String(sheets[i].getRange('B10').getValue())
    if (responseTime=="Same Day")  {
      responseTimes[0]++
    } else if (responseTime=="<= 24 Hours") {
      responseTimes[1]++
    } else if (responseTime=="24-48 Hours") {
      responseTimes[2]++
    } else if (responseTime=="Over 48 Hours") {
      responseTimes[3]++
    }
    //Satisfaction Level
    var satisfactionLevel = new String(sheets[i].getRange('B16').getValue())
    if (satisfactionLevel=="Satisfied") {
      satisfactionLevels[0]++
    } else if (satisfactionLevel=="Moderately Satisfied") {
      satisfactionLevels[1]++
    } else if (satisfactionLevel=="Unsatisfied") {
      satisfactionLevels[2]++
    } else if (satisfactionLevel=="Not Sure") {
      satisfactionLevels[3]++
    }
    //Communication Issues
    issues_followingInstructions+=sheets[i].getRange('A19').getValue()
    issues_languageBarrier+=sheets[i].getRange('A20').getValue()
    //Additional Metrics
    impact_wouldHaveDisconnected+=sheets[i].getRange('A23').getValue()
    impact_wouldHaveContactedGrantee+=sheets[i].getRange('A24').getValue()
    impact_intereferedWithWork+=sheets[i].getRange('A25').getValue()

    //debug
    console.log("Open: " + numOpenTickets)
    console.log("Closed: " + numClosedTickets)

    display()
  }
}

function display() {
  sheets[1].getRange('B2').setValue(numberOfTickets())
  sheets[1].getRange('B5').setValue(responseTimes[0])
  sheets[1].getRange('B6').setValue(responseTimes[1])
  sheets[1].getRange('B7').setValue(responseTimes[2])
  sheets[1].getRange('B8').setValue(responseTimes[3])
  sheets[1].getRange('B11').setValue(numOpenTickets)
  sheets[1].getRange('B12').setValue(numClosedTickets)
  sheets[1].getRange('B15').setValue(satisfactionLevels[0])
  sheets[1].getRange('B16').setValue(satisfactionLevels[1])
  sheets[1].getRange('B17').setValue(satisfactionLevels[2])
  sheets[1].getRange('B18').setValue(satisfactionLevels[3])
  sheets[1].getRange('B21').setValue(issues_followingInstructions)
  sheets[1].getRange('B22').setValue(issues_languageBarrier)
  sheets[1].getRange('B25').setValue(impact_wouldHaveDisconnected)
  sheets[1].getRange('B26').setValue(impact_wouldHaveContactedGrantee)
  sheets[1].getRange('B27').setValue(impact_intereferedWithWork)
}

//for entry on google sheets
function sheetName() {
  return SpreadsheetApp.getActiveSpreadsheet().getActiveSheet().getName()
}

function numberOfTickets() {
  return sheets.length - 3
}
